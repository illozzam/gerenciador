{% load staticfiles %}
<!DOCTYPE html>
<!--
	This is a starter template page. Use this page to start your new project from
	scratch. This page gets rid of all links and provides the needed markup only.
	-->
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Mazzolli Sistemas - Gerenciador</title>
		<!-- Tell the browser to be responsive to screen width -->
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<link rel="stylesheet" href="{% static 'bibliotecas/bootstrap/dist/css/bootstrap.min.css' %}">
		<!-- Font Awesome -->
		<link rel="stylesheet" href="{% static 'bibliotecas/font-awesome/css/font-awesome.min.css' %}">
		<!-- Ionicons -->
		<link rel="stylesheet" href="{% static 'bibliotecas/Ionicons/css/ionicons.min.css' %}">
		<!-- Theme style -->
		<link rel="stylesheet" href="{% static 'css/AdminLTE.min.css' %}">
		<!-- AdminLTE Skins. We have chosen the skin-blue for this starter
			page. However, you can choose any other skin. Make sure you
			apply the skin class to the body tag so the changes take effect. -->
		<link rel="stylesheet" href="{% static 'css/skins/skin-yellow.min.css' %}">
		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
		<!-- Google Font -->
		<link rel="stylesheet"
			href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">

		<link rel="stylesheet" href="{% static 'css/estilo.css' %}">

		{% block cabecalho %}{% endblock cabecalho %}
	</head>
	<!--
		BODY TAG OPTIONS:
		=================
		Apply one or more of the following classes to get the
		desired effect
		|---------------------------------------------------------|
		| SKINS         | skin-blue                               |
		|               | skin-black                              |
		|               | skin-purple                             |
		|               | skin-yellow                             |
		|               | skin-red                                |
		|               | skin-green                              |
		|---------------------------------------------------------|
		|LAYOUT OPTIONS | fixed                                   |
		|               | layout-boxed                            |
		|               | layout-top-nav                          |
		|               | sidebar-collapse                        |
		|               | sidebar-mini                            |
		|---------------------------------------------------------|
		-->
	<body class="hold-transition skin-yellow sidebar-mini">
		<div class="wrapper">
			<!-- Main Header -->
			<header class="main-header">
				<!-- Logo -->
				<a href="{% url 'inicial' %}" class="logo">
					<!-- mini logo for sidebar mini 50x50 pixels -->
					<span class="logo-mini">MS</span>
					<!-- logo for regular state and mobile devices -->
					<span class="logo-lg">Mazzolli Sistemas</span>
				</a>
				<!-- Header Navbar -->
				<nav class="navbar navbar-static-top" role="navigation">
					<!-- Sidebar toggle button-->
					<a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
					<span class="sr-only">Toggle navigation</span>
					</a>
					<!-- Navbar Right Menu -->
					<div class="navbar-custom-menu">
						<ul class="nav navbar-nav">
							<!-- Messages: style can be found in dropdown.less-->
							<li class="dropdown messages-menu">
								<!-- Menu toggle button -->
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								<i class="fa fa-envelope-o"></i>
								<span class="label label-success" id="quantMensagens" style="display: none;"></span>
								</a>
								<ul class="dropdown-menu" id="alertaMensagens">
									<!-- Controle de mensagens aqui -->
								</ul>
							</li>
							<!-- /.messages-menu -->
							<!-- Tasks Menu -->
							<li class="dropdown tasks-menu">
								<!-- Menu Toggle Button -->
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								<i class="fa fa-flag-o"></i>
								<span class="label label-danger">9</span>
								</a>
								<ul class="dropdown-menu">
									<li class="header">Você tem 9 tarefas</li>
									<li>
										<!-- Inner menu: contains the tasks -->
										<ul class="menu">
											<li>
												<!-- Task item -->
												<a href="#">
													<!-- Task title and progress text -->
													<h3>
														Design some buttons
														<small class="pull-right">20%</small>
													</h3>
													<!-- The progress bar -->
													<div class="progress xs">
														<!-- Change the css width attribute to simulate progress -->
														<div class="progress-bar progress-bar-aqua" style="width: 20%" role="progressbar"
															aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
															<span class="sr-only">20% Complete</span>
														</div>
													</div>
												</a>
											</li>
											<!-- end task item -->
										</ul>
									</li>
									<li class="footer">
										<a href="#">VER TODAS</a>
									</li>
								</ul>
							</li>
							<!-- User Account Menu -->
							<li class="dropdown user user-menu">
								<!-- Menu Toggle Button -->
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<!-- The user image in the navbar-->
									{% if request.user.usuario_set.first.facebook %}
										<img src="https://graph.facebook.com/v2.10/{{request.user.usuario_set.first.facebook}}/picture?type=large" class="user-image">
									{% else %}
										<img src="{% static 'imagens/usuario.png' %}" class="user-image">
									{% endif %}
									<!-- hidden-xs hides the username on small devices so only the image appears. -->
									<span class="hidden-xs">{{request.user.get_full_name}}</span>
								</a>
								<ul class="dropdown-menu">
									<!-- The user image in the menu -->
									<li class="user-header">
										{% if request.user.usuario_set.first.facebook %}
											<img src="https://graph.facebook.com/v2.10/{{request.user.usuario_set.first.facebook}}/picture?type=large" class="img-circle">
										{% else %}
											<img src="{% static 'imagens/usuario.png' %}" class="img-circle">
										{% endif %}
										<p>
											{{request.user.get_full_name}} - {{request.user.usuario_set.first.cargo}}
											<small>Membro desde {{request.user.date_joined|date:'SHORT_DATE_FORMAT'}}</small>
										</p>
									</li>
									<!-- Menu Footer-->
									<li class="user-footer">
										<div class="pull-left">
											<a href="{% url 'telaPerfilUsuario' %}" class="btn btn-default btn-flat">Perfil</a>
										</div>
										<div class="pull-right">
											<a href="{% url 'logout' %}" class="btn btn-default btn-flat">Sair</a>
										</div>
									</li>
								</ul>
							</li>
							<!-- Control Sidebar Toggle Button -->
							<li>
								<a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
							</li>
						</ul>
					</div>
				</nav>
			</header>
			<!-- Left side column. contains the logo and sidebar -->
			<aside class="main-sidebar">
				<!-- sidebar: style can be found in sidebar.less -->
				<section class="sidebar">
					<!-- Sidebar user panel (optional) -->
					<div class="user-panel">
						<div class="pull-left image">
							{% if request.user.usuario_set.first.facebook %}
								<img src="https://graph.facebook.com/v2.10/{{request.user.usuario_set.first.facebook}}/picture?type=large" class="img-circle">
							{% else %}
								<img src="{% static 'imagens/usuario.png' %}" class="img-circle">
							{% endif %}
						</div>
						<div class="pull-left info">
							<p>{{request.user.get_full_name}}</p>
							<!-- Status -->
							<a href="{% url 'logout' %}"><i class="fa fa-circle text-danger"></i> Sair</a>
						</div>
					</div>
					<!-- Sidebar Menu -->
					<ul class="sidebar-menu" data-widget="tree">
						<li class="header">PRINCIPAL</li>
						<li class="active"><a href="{% url 'inicial' %}"><i class="fa fa-home"></i> <span>Inicial</span></a></li>
						<li><a href="{% url 'telaTarefas' %}"><i class="fa fa-check"></i><span>Agenda de Tarefas</span></a></li>

						<li class="header">VENDAS</li>
						{% if perms.principal.add_cliente %}
							<li class="treeview">
								<a href="#"><i class="fa fa-user"></i> <span>Clientes</span>
									<span class="pull-right-container">
										<i class="fa fa-angle-left pull-right"></i>
									</span>
								</a>
								<ul class="treeview-menu">
									<li><a href="{% url 'telaAdicionarCliente' %}">Adicionar...</a></li>
									<li><a href="{% url 'telaBuscarCliente' %}">Buscar...</a></li>
								</ul>
							</li>
						{% endif %}
						{% if perms.principal.add_contrato %}
							<li class="treeview">
								<a href="#"><i class="fa fa-book"></i> <span>Contratos</span>
									<span class="pull-right-container">
										<i class="fa fa-angle-left pull-right"></i>
									</span>
								</a>
								<ul class="treeview-menu">
									<li><a href="{% url 'telaAdicionarContrato' %}">Adicionar...</a></li>
									<li><a href="{% url 'telaBuscarContrato' %}">Buscar...</a></li>
								</ul>
							</li>
						{% endif %}
						{% if perms.principal.add_consultoria %}
							<li class="treeview">
								<a href="#"><i class="fa fa-address-book-o"></i> <span>Consultorias</span>
									<span class="pull-right-container">
										<i class="fa fa-angle-left pull-right"></i>
									</span>
								</a>
								<ul class="treeview-menu">
									<li><a href="{% url 'telaCriarConsultoria' %}">Criar...</a></li>
									<li><a href="{% url 'telaAdicionarConsultoria' %}">Adicionar...</a></li>
									<li><a href="{% url 'telaBuscarConsultoria' %}">Buscar...</a></li>
								</ul>
							</li>
						{% endif %}

						{% if perms.principal.add_tesouraria or perms.principal.add_contaapagar or perms.principal.add_contaareceber %}
							<li class="header">FINANCEIRO</li>
							<li><a href="{% url 'telaContasAReceber' %}"><i class="fa fa-reply"></i> <span>Contas a Receber</span></a></li>
							<li><a href="{% url 'telaContasAPagar' %}"><i class="fa fa-share"></i> <span>Contas a Pagar</span></a></li>
							<li><a href="{% url 'telaTesouraria' %}"><i class="fa fa-money"></i> <span>Tesouraria</span></a></li>
						{% endif %}
					</ul>

					<!-- <ul class="sidebar-menu" data-widget="tree">
						<li class="header">PRINCIPAL</li>
						<li class="active"><a href="#"><i class="fa fa-home"></i> <span>Inicial</span></a></li>
						<li><a href="#"><i class="fa fa-link"></i> <span>Another Link</span></a></li>
						<li class="treeview">
							<a href="#"><i class="fa fa-link"></i> <span>Multilevel</span>
							<span class="pull-right-container">
							<i class="fa fa-angle-left pull-right"></i>
							</span>
							</a>
							<ul class="treeview-menu">
								<li><a href="#">Link in level 2</a></li>
								<li><a href="#">Link in level 2</a></li>
							</ul>
						</li>
					</ul> -->
					<!-- /.sidebar-menu -->
				</section>
				<!-- /.sidebar -->
			</aside>
			<!-- Content Wrapper. Contains page content -->
			<div class="content-wrapper">
				<!-- Content Header (Page header) -->
				<section class="content-header">
					<h1>
						{% block titulo %}
							Inicial
							<small>Resumo das Atividades</small>
						{% endblock titulo %}
					</h1>
					{% block breadcrumb %}
						<!--<ol class="breadcrumb">
						<li><a href="#"><i class="fa fa-dashboard"></i> Level</a></li>
						<li class="active">Here</li>
					</ol>-->
					{% endblock breadcrumb %}
				</section>
				<!-- Main content -->
				<section class="content container-fluid">
					{% block controles %}
						<!--------------------------
						| Your Page Content Here |
						-------------------------->
					{% endblock controles %}
				</section>
				<!-- /.content -->
			</div>
			<!-- /.content-wrapper -->
			<!-- Main Footer -->
			<footer class="main-footer">
				<!-- To the right -->
				<div class="pull-right hidden-xs">
					Todos os direitos reservados.
				</div>
				<!-- Default to the left -->
				<strong>Copyright &copy; 2017 <a href="http://www.mazzollisistemas.com.br" target="_blank">Mazzolli Sistemas</a></strong>
			</footer>
			<!-- Control Sidebar -->
			<aside class="control-sidebar control-sidebar-dark">
				<!-- Create the tabs -->
				<ul class="nav nav-tabs nav-justified control-sidebar-tabs">
					<li class="active"><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
					<li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
				</ul>
				<!-- Tab panes -->
				<div class="tab-content">
					<!-- Home tab content -->
					<div class="tab-pane active" id="control-sidebar-home-tab">
						<!--<h3 class="control-sidebar-heading">Recent Activity</h3>
						<ul class="control-sidebar-menu">
							<li>
								<a href="javascript:;">
									<i class="menu-icon fa fa-birthday-cake bg-red"></i>
									<div class="menu-info">
										<h4 class="control-sidebar-subheading">Langdon's Birthday</h4>
										<p>Will be 23 on April 24th</p>
									</div>
								</a>
							</li>
						</ul> -->
						<!-- /.control-sidebar-menu -->
						<h3 class="control-sidebar-heading">Tarefas em Andamento</h3>
						<ul class="control-sidebar-menu">
							<li>
								<a href="javascript:;">
									<h4 class="control-sidebar-subheading">
										Exemplo de tarefa
										<span class="pull-right-container">
										<span class="label label-warning pull-right">70%</span>
										</span>
									</h4>
									<div class="progress progress-xxs">
										<div class="progress-bar progress-bar-warning" style="width: 70%"></div>
									</div>
								</a>
							</li>
						</ul>
						<!-- /.control-sidebar-menu -->
					</div>
					<!-- /.tab-pane -->
					<!-- Stats tab content -->
					<div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div>
					<!-- /.tab-pane -->
					<!-- Settings tab content -->
					<div class="tab-pane" id="control-sidebar-settings-tab">
						<form method="post">
							<h3 class="control-sidebar-heading">Configurações Gerais</h3>
							<div class="form-group">
								<label class="control-sidebar-subheading">
								Opção 1
								<input type="checkbox" class="pull-right" checked>
								</label>
								<p>
									Informação a respeito da opção 1
								</p>
							</div>
							<!-- /.form-group -->
						</form>
					</div>
					<!-- /.tab-pane -->
				</div>
			</aside>
			<!-- /.control-sidebar -->
			<!-- Add the sidebar's background. This div must be placed
				immediately after the control sidebar -->
			<div class="control-sidebar-bg"></div>
		</div>
		<!-- ./wrapper -->
		<!-- REQUIRED JS SCRIPTS -->
		<!-- jQuery 3 -->
		<script src="{% static 'bibliotecas/jquery/dist/jquery.min.js' %}"></script>
		<!-- Bootstrap 3.3.7 -->
		<script src="{% static 'bibliotecas/bootstrap/dist/js/bootstrap.min.js' %}"></script>
		<!-- Moment.JS -->
		<script src="{% static 'bibliotecas/momentjs/moment.min.js' %}"></script>
		<!-- AdminLTE App -->
		<script src="{% static 'js/adminlte.min.js' %}"></script>
		<!-- Optionally, you can add Slimscroll and FastClick plugins.
			Both of these plugins are recommended to enhance the
			user experience. -->

		<script src="{% static 'bibliotecas/sweetalert2/sweetalert2-all.min.js' %}"></script>

		<script type="text/javascript">
			function atualizaAlertas() {
				moment.locale('pt-BR')
				$.get('{% url 'verificarMensagens' %}')
				.done(function(resposta) {
					if (resposta.mensagens.length > 0) {
						$('#quantMensagens').html(resposta.mensagens.length)
						$('#quantMensagens').css('display', 'block')
					}

					$('#alertaMensagens').html('')
					if (resposta.mensagens.length > 0) {
						$('#alertaMensagens').append(`
							<li class="header">Você tem ${resposta.mensagens.length} mensagem(ns) não lida(s)</li>
							<li>
								<ul class="menu" id="listaMensagens">

								</ul>
							</li>
						`)
					} else {
						$('#alertaMensagens').append('<li class="header">Nenhuma mensagem não lida.</li>')
					}
					for(i=0; i<resposta.mensagens.length; i++) {
						$('#listaMensagens').append(`
							<li>
								<!-- start message -->
								<a href="/telas/mensagem/${resposta.mensagens[i].id}/">
									<div class="pull-left">
										<!-- User Image -->
										<img src="${
											resposta.mensagens[i].remetente__facebook != '' ?
											'https://graph.facebook.com/v2.10/' + resposta.mensagens[i].remetente__facebook + '/picture?type=large' :
											'{% static 'imagens/usuario.png' %}'
										}" class="img-circle">
									</div>
									<!-- Message title and timestamp -->
									<h4>
										${
											resposta.mensagens[i].assunto.length > resposta.mensagens[i].assunto.split(' ').splice(0, 3).join(' ').length ?
											resposta.mensagens[i].assunto.split(" ").splice(0,3).join(" ") + '...' :
											resposta.mensagens[i].assunto
										}
										<small><i class="fa fa-clock-o"></i> ${moment(resposta.mensagens[i].dataHoraEnvio).fromNow()}</small>
									</h4>
									<!-- The message -->
									<p>
										${resposta.mensagens[i].remetente__usuario__first_name}&nbsp;
										${resposta.mensagens[i].remetente__usuario__last_name}
									</p>
								</a>
							</li>
						`)
					}
					$('#alertaMensagens').append('<li class="footer"><a href="{% url 'telaMensagensEntrada' %}">VER TODAS</a></li>')
				})
			}

			$(document).ready(function() {
				atualizaAlertas()
			})
		</script>

		{% block processamento %}{% endblock processamento %}

	</body>
</html>
